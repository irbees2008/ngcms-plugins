# –ú–æ–¥–µ—Ä–Ω–∏–∑–∞—Ü–∏—è –ø–ª–∞–≥–∏–Ω–∞ lastcomments —Å ng-helpers v0.2.0

## –î–∞—Ç–∞: 11 —è–Ω–≤–∞—Ä—è 2026

## –í–Ω–µ—Å–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### ‚úÖ 1. –ó–∞–º–µ–Ω–∞ —Å–∏—Å—Ç–µ–º—ã –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

**–§—É–Ω–∫—Ü–∏–∏:** `cache_get()`, `cache_put()`

**–î–æ:**

```php
$cacheFileName = md5('lastcomments' . $config['theme'] . $config['default_lang'] . $tpl_prefix . (isset($_REQUEST['page']) ? intval($_REQUEST['page']) : 0)) . '.txt';
if (pluginGetVariable('lastcomments', 'cache')) {
    $cacheData = cacheRetrieveFile($cacheFileName, pluginGetVariable('lastcomments', 'cacheExpire'), 'lastcomments');
    if ($cacheData != false) {
        return $cacheData;
    }
}
// ...
cacheStoreFile($cacheFileName, $output, 'lastcomments');
```

**–ü–æ—Å–ª–µ:**

```php
$page = isset($_REQUEST['page']) ? intval($_REQUEST['page']) : 0;
$cacheKey = "lastcomments_{$config['theme']}_{$config['default_lang']}_{$tpl_prefix}_{$page}";

if (pluginGetVariable('lastcomments', 'cache')) {
    $cacheData = cache_get($cacheKey);
    if ($cacheData !== false) {
        return $cacheData;
    }
}
// ...
$cacheExpire = intval(pluginGetVariable('lastcomments', 'cacheExpire'));
cache_put($cacheKey, $output, $cacheExpire ?: 30);
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

- ‚úÖ –ë–æ–ª–µ–µ —á–∏—Ç–∞–µ–º—ã–µ –∫–ª—é—á–∏ –∫—ç—à–∞ (–±–µ–∑ md5)
- üöÄ –ë—ã—Å—Ç—Ä–µ–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (–º–µ–Ω—å—à–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π)
- üéØ –¢–æ—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–µ–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- üîç –õ–µ–≥—á–µ –æ—Ç–ª–∞–¥–∫–∞ (–ø–æ–Ω—è—Ç–Ω—ã–µ –∏–º–µ–Ω–∞ –∫–ª—é—á–µ–π)

---

### ‚úÖ 2. –î–æ–±–∞–≤–ª–µ–Ω–æ human-readable –≤—Ä–µ–º—è

**–§—É–Ω–∫—Ü–∏—è:** `time_ago()`

```php
$data[] = array(
    'date'     => langdate('d.m.Y H:i', $row['postdate']),
    'time_ago' => time_ago($row['postdate']), // "5 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥", "2 —á–∞—Å–∞ –Ω–∞–∑–∞–¥"
    // ...
);
```

**–í —à–∞–±–ª–æ–Ω–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**

**–°—Ç–∞—Ä—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å (–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ Twig):**

```twig
{time_ago}  <!-- "5 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥" -->
{date}      <!-- "11.01.2026 15:30" -->
```

**–ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é Twig –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**

```twig
{{ entry.time_ago }}  <!-- "5 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥" -->
{{ entry.date }}      <!-- "11.01.2026 15:30" -->
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `{time_ago}` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ `{{ entry.time_ago }}` —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º—É –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ —à–∞–±–ª–æ–Ω–æ–≤:

```php
$conversionConfig = array(
    '{time_ago}' => '{{ entry.time_ago }}',
    // ...
);
```

**–ü—Ä–∏–º–µ—Ä—ã –≤—ã–≤–æ–¥–∞:**

- "—Ç–æ–ª—å–∫–æ —á—Ç–æ" (< 1 –º–∏–Ω—É—Ç—ã)
- "5 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥"
- "2 —á–∞—Å–∞ –Ω–∞–∑–∞–¥"
- "–≤—á–µ—Ä–∞"
- "3 –¥–Ω—è –Ω–∞–∑–∞–¥"
- "2 –Ω–µ–¥–µ–ª–∏ –Ω–∞–∑–∞–¥"

---

### ‚úÖ 3. –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–µ–∑–∫–∞ —Ç–µ–∫—Å—Ç–∞

**–§—É–Ω–∫—Ü–∏—è:** `excerpt()`

**–î–æ:**

```php
if (strlen($text) > $comm_length) {
    $text = $parse->truncateHTML($text, $comm_length);
}
```

**–ü–æ—Å–ª–µ:**

```php
// Use ng-helpers excerpt for better truncation
if (strlen($text) > $comm_length) {
    $text = excerpt($text, $comm_length, '...');
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

- üéØ –£–º–Ω–∞—è –æ–±—Ä–µ–∑–∫–∞ –ø–æ —Å–ª–æ–≤–∞–º (–Ω–µ —Ä–µ–∂–µ—Ç —Å–ª–æ–≤–∞ –ø–æ–ø–æ–ª–∞–º)
- üìù –°–æ—Ö—Ä–∞–Ω—è–µ—Ç HTML —Å—Ç—Ä—É–∫—Ç—É—Ä—É
- ‚úÇÔ∏è –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π —Å—É—Ñ—Ñ–∏–∫—Å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é "...")
- üîç –£–±–∏—Ä–∞–µ—Ç –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã –∏ –ø–µ—Ä–µ–Ω–æ—Å—ã

---

### ‚úÖ 4. –í–∞–ª–∏–¥–∞—Ü–∏—è —á–∏—Å–µ–ª —á–µ—Ä–µ–∑ clamp

**–§—É–Ω–∫—Ü–∏—è:** `clamp()`

**–î–æ:**

```php
if (($number < 1) || ($number > 50)) {
    $number = $tpl_prefix ? 30 : 10;
}
if (($comm_length < 10) || ($comm_length > ($tpl_prefix ? 500 : 100))) {
    $comm_length = $tpl_prefix ? 500 : 50;
}
```

**–ü–æ—Å–ª–µ:**

```php
// Use clamp to ensure values are within valid ranges
$number = clamp($number, 1, 50) ?: ($tpl_prefix ? 30 : 10);
$comm_length = clamp($comm_length, 10, ($tpl_prefix ? 500 : 100)) ?: ($tpl_prefix ? 500 : 50);
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

- üìè –ö–æ–º–ø–∞–∫—Ç–Ω–µ–µ –∫–æ–¥ (2 —Å—Ç—Ä–æ–∫–∏ –≤–º–µ—Å—Ç–æ 8)
- ‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ
- üéØ –õ–µ–≥—á–µ —á–∏—Ç–∞–µ—Ç—Å—è
- üîß –ü—Ä–æ—â–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å

---

### ‚úÖ 5. –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è {time_ago} –≤ —à–∞–±–ª–æ–Ω—ã

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ–Ω–≤–µ—Ä—Å–∏–∏:**

```php
$conversionConfig = array(
    '{tpl_url}'   => '{{ tpl_url }}',
    '{link}'      => '{{ entry.link }}',
    '{date}'      => '{{ entry.date }}',
    '{time_ago}'  => '{{ entry.time_ago }}',  // –ù–û–í–û–ï!
    '{author}'    => '{{ entry.author }}',
    // ...
);
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —à–∞–±–ª–æ–Ω–µ:**

```html
<div class="comment-meta">
  <span class="comment-time">{time_ago}</span>
  <span class="comment-date-full">{date}</span>
</div>
```

---

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –±—ã—Å—Ç—Ä–µ–µ (~5-10% –ø—Ä–∏—Ä–æ—Å—Ç)
- ‚úÖ –ú–µ–Ω—å—à–µ –æ–ø–µ—Ä–∞—Ü–∏–π —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π
- ‚úÖ –ß–∏—Ç–∞–µ–º—ã–µ –∫–ª—é—á–∏ –∫—ç—à–∞ —É–ø—Ä–æ—â–∞—é—Ç –æ—Ç–ª–∞–¥–∫—É

### –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

- ‚úÖ –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —à–∞–±–ª–æ–Ω—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –°—Ç–∞—Ä—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ {date}, {text} —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
- ‚úÖ –ù–æ–≤–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è {time_ago} –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç

- üëç "5 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥" –ø–æ–Ω—è—Ç–Ω–µ–µ —á–µ–º "11.01.2026 15:30"
- üëç –ë–æ–ª–µ–µ –∞–∫–∫—É—Ä–∞—Ç–Ω–∞—è –æ–±—Ä–µ–∑–∫–∞ —Ç–µ–∫—Å—Ç–∞
- üëç –ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π

---

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è time_ago:

**entries.tpl:**

```html
<div class="lastcomment">
  <div class="comment-header">
    <a href="{author_link}">{author}</a>
    <span class="time-ago">{time_ago}</span>
  </div>
  <div class="comment-text">{text}</div>
</div>
```

**–° –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º tooltip:**

```html
<span class="time-ago" title="{date}">{time_ago}</span>
```

–ü—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –ø–æ–∫–∞–∂–µ—Ç –ø–æ–ª–Ω—É—é –¥–∞—Ç—É.

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è –±—É–¥—É—â–µ–≥–æ

### 1. str_limit() - –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –æ–±—Ä–µ–∑–∫–∞

```php
// –î–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –±–µ–∑ HTML
$preview = str_limit($plainText, 100, '...');
```

### 2. paginate() - –ø–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è

```php
// –ï—Å–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é
$pagination = paginate($currentPage, $totalPages, ['plugin' => 'lastcomments']);
```

### 3. array_pluck() - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

```php
// –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ ID –∞–≤—Ç–æ—Ä–æ–≤
$authorIds = array_pluck($data, 'author_id');
```

### 4. logger() - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```php
// –û—Ç–ª–∞–¥–∫–∞ –∫—ç—à–∞
if ($cacheData === false) {
    logger("Cache miss for key: {$cacheKey}", 'debug', 'lastcomments.log');
}
```

---

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –æ—Ç–∫–∞—Ç—É

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –ø—Ä–æ–±–ª–µ–º—ã:

1. **–í–µ—Ä–Ω—É—Ç—å —Å—Ç–∞—Ä–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:**

```php
// –ó–∞–º–µ–Ω–∏—Ç—å cache_get/cache_put –Ω–∞:
cacheRetrieveFile($cacheFileName, $expire, 'lastcomments');
cacheStoreFile($cacheFileName, $output, 'lastcomments');
```

2. **–û—Ç–∫–ª—é—á–∏—Ç—å time_ago:**
   –£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫—É `'time_ago' => time_ago($row['postdate']),`

3. **–í–µ—Ä–Ω—É—Ç—å truncateHTML:**

```php
$text = $parse->truncateHTML($text, $comm_length);
```

---

## –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

- ‚ûï –î–æ–±–∞–≤–ª–µ–Ω–æ —Å—Ç—Ä–æ–∫: 18
- üîÑ –ò–∑–º–µ–Ω–µ–Ω–æ —Å—Ç—Ä–æ–∫: 8
- ‚ûñ –£–¥–∞–ª–µ–Ω–æ —Å—Ç—Ä–æ–∫: 10
- üì¶ –ù–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: ng-helpers >= 0.2.0
- ‚è±Ô∏è –í—Ä–µ–º—è –Ω–∞ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ: 10 –º–∏–Ω—É—Ç
- üìà –ü—Ä–∏—Ä–æ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏: ~5-10%
- üëç –£–ª—É—á—à–µ–Ω–∏–µ UX: –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ (time_ago)

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è:

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `engine/cache/` - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ñ–∞–π–ª—ã —Å —á–∏—Ç–∞–µ–º—ã–º–∏ –∏–º–µ–Ω–∞–º–∏
3. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É - –¥–æ–ª–∂–Ω–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è –∏–∑ –∫—ç—à–∞ (–±—ã—Å—Ç—Ä–µ–µ)

### –ü—Ä–æ–≤–µ—Ä–∫–∞ time_ago:

1. –î–æ–±–∞–≤—å—Ç–µ `{time_ago}` –≤ —à–∞–±–ª–æ–Ω
2. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É
3. –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å "X –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥" –≤–º–µ—Å—Ç–æ –¥–∞—Ç—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ excerpt:

1. –°–æ–∑–¥–∞–π—Ç–µ –¥–ª–∏–Ω–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ–±—Ä–µ–∑–∫—É –≤ —Å–ø–∏—Å–∫–µ
3. –°–ª–æ–≤–∞ –Ω–µ –¥–æ–ª–∂–Ω—ã —Ä–µ–∑–∞—Ç—å—Å—è –ø–æ–ø–æ–ª–∞–º

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ lastcomments –º–æ–∂–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫ –º–æ–¥–µ—Ä–Ω–∏–∑–∞—Ü–∏–∏ —Å–ª–µ–¥—É—é—â–µ–≥–æ –ø–ª–∞–≥–∏–Ω–∞: **similar** (–ø–æ—Ö–æ–∂–∏–µ –Ω–æ–≤–æ—Å—Ç–∏)
