# WebPush v1.0.4 - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–¥–∞—á–∏ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞

**–î–∞—Ç–∞:** 17 —è–Ω–≤–∞—Ä—è 2026
**–í–µ—Ä—Å–∏—è:** 1.0.4
**–ü—Ä–µ–¥—ã–¥—É—â–∞—è:** 1.0.3

## üî¥ –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–æ–±—â–∏–ª: **"–æ—à–∏–±–∫–∞ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω, —É–∂–µ –¥–≤–∞–∂–¥—ã –∫–ª—é—á –ø–æ–ª—É—á–∞–ª –∏ –¥–æ–±–∞–≤–ª—è–ª, –≤—Å–µ —Ä–∞–≤–Ω–æ –æ—à–∏–±–∫–∞"**

–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –±—Ä–∞—É–∑–µ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–ª –æ—à–∏–±–∫—É "–ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω", —Ö–æ—Ç—è –∫–ª—é—á–∏ –±—ã–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏.

## üîç –ü—Ä–∏—á–∏–Ω—ã

1. **–ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –Ω–µ –ø–µ—Ä–µ–¥–∞–≤–∞–ª—Å—è –≤ HTML:**

   - –í —à–∞–±–ª–æ–Ω–µ `webpush.tpl` –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª data-–∞—Ç—Ä–∏–±—É—Ç `data-public-key`
   - JavaScript –¥–µ–ª–∞–ª –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–ª—é—á–∞
   - –ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –∑–∞–ø—Ä–æ—Å–æ–º –∫–ª—é—á –æ—Å—Ç–∞–≤–∞–ª—Å—è –ø—É—Å—Ç—ã–º

2. **–°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –≤ endpoint.php:**

   ```php
   // –û–®–ò–ë–ö–ê (—Å—Ç—Ä–æ–∫–∞ 191):
   if (webpush_log('Subscription attempt without endpoint', 'warning');
   // –ü—Ä–æ–ø—É—â–µ–Ω–æ —É—Å–ª–æ–≤–∏–µ empty($endpoint)

   // –û–®–ò–ë–ö–ê (—Å—Ç—Ä–æ–∫–∞ 219):
   webpush_log('Subscribe: ' . parse_url($endpoint, PHP_URL_HOST) . ' (' . $deviceType . ')'   'auth' => $auth,
   // –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞, –Ω–µ–≤–µ—Ä–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
   ```

3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:**
   - –ù–µ –±—ã–ª–æ —Å–ø–æ—Å–æ–±–∞ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –ª–∏ –∫–ª—é—á –≤ —à–∞–±–ª–æ–Ω
   - –ù–µ –±—ã–ª–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ü–µ—Ä–µ–¥–∞—á–∞ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞ —á–µ—Ä–µ–∑ data-–∞—Ç—Ä–∏–±—É—Ç

**–§–∞–π–ª: engine/plugins/webpush/tpl/webpush.tpl**

```diff
- <button type="button" id="webpush-subscribe-btn" class="webpush-btn webpush-btn-subscribe"
-   data-endpoint="{{ endpoint }}"
-   data-subscribe-text="{{ subscribe_text }}"
-   data-unsubscribe-text="{{ unsubscribe_text }}">

+ <button type="button" id="webpush-subscribe-btn" class="webpush-btn webpush-btn-subscribe"
+   data-endpoint="{{ endpoint }}"
+   data-subscribe-text="{{ subscribe_text }}"
+   data-unsubscribe-text="{{ unsubscribe_text }}"
+   data-public-key="{{ public_key }}">
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

- ‚úÖ –ö–ª—é—á –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É –≤ HTML –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π AJAX-–∑–∞–ø—Ä–æ—Å
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å —Å–µ—Ç—å—é
- ‚úÖ –ö–ª—é—á –¥–æ—Å—Ç—É–ø–µ–Ω —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

### 2. –£–ª—É—á—à–µ–Ω–∏–µ JavaScript –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–ª—é—á–∞

**–§–∞–π–ª: engine/plugins/webpush/js/webpush.js**

```javascript
// –ü–æ–ª—É—á–∞–µ–º –∫–ª—é—á –∏–∑ data-–∞—Ç—Ä–∏–±—É—Ç–∞ –∫–Ω–æ–ø–∫–∏
const publicKeyFromButton = btn.dataset.publicKey || "";

/**
 * –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞
 */
async function getPublicKey() {
  // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º –≤–∑—è—Ç—å –∏–∑ data-–∞—Ç—Ä–∏–±—É—Ç–∞
  if (publicKeyFromButton) {
    console.log("Using public key from button data-attribute");
    return publicKeyFromButton;
  }

  // –ï—Å–ª–∏ –Ω–µ—Ç - –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Å —Å–µ—Ä–≤–µ—Ä–∞ (fallback)
  try {
    console.log("Fetching public key from server...");
    const response = await fetch(`${endpoint}?action=key`, {
      cache: "no-store",
    });

    const data = await response.json();
    console.log(
      "Public key from server:",
      data.publicKey ? "received" : "empty"
    );
    return data.publicKey || "";
  } catch (error) {
    console.error("Failed to get public key:", error);
    return "";
  }
}
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

- ‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç data-–∞—Ç—Ä–∏–±—É—Ç–∞ –Ω–∞–¥ –∑–∞–ø—Ä–æ—Å–æ–º –∫ —Å–µ—Ä–≤–µ—Ä—É
- ‚úÖ Fallback –Ω–∞ API endpoint –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∫–ª—é—á–∞ (data-attribute / server)

### 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ –≤ endpoint.php

**–§–∞–π–ª: engine/plugins/webpush/endpoint.php**

```diff
// –ë–´–õ–û (–æ—à–∏–±–∫–∞):
- if (webpush_log('Subscription attempt without endpoint', 'warning');
-     http_response_code(400);
-     echo json_encode(['ok' => false, 'error' => 'No endpoint'], JSON_UNESCAPED_UNICODE);
-     exit;
- }

// –°–¢–ê–õ–û (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
+ if (empty($endpoint)) {
+     webpush_log('Subscription attempt without endpoint', 'warning');
+     http_response_code(400);
+     echo json_encode(['ok' => false, 'error' => 'No endpoint'], JSON_UNESCAPED_UNICODE);
+     exit;
+ }
```

```diff
// –ë–´–õ–û (–æ—à–∏–±–∫–∞):
- webpush_log('Subscribe: ' . parse_url($endpoint, PHP_URL_HOST) . ' (' . $deviceType . ')'   'auth' => $auth,
- ]);
- echo json_encode(['ok' => true], JSON_UNESCAPED_UNICODE);

// –°–¢–ê–õ–û (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
+ webpush_log('Subscribe: ' . parse_url($endpoint, PHP_URL_HOST) . ' (' . $deviceType . ')');
+ echo json_encode(['ok' => true], JSON_UNESCAPED_UNICODE);
```

### 4. –°–æ–∑–¥–∞–Ω –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

**–§–∞–π–ª: engine/plugins/webpush/check_config.php**

–ù–æ–≤—ã–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:

1. ‚úÖ –°—Ç–∞—Ç—É—Å –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø–ª–∞–≥–∏–Ω–∞
2. ‚úÖ –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (enabled, show_button)
3. ‚úÖ VAPID –∫–ª—é—á–∏ (–ø—É–±–ª–∏—á–Ω—ã–π, –ø—Ä–∏–≤–∞—Ç–Ω—ã–π, subject)
4. ‚úÖ Composer –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (minishlink/web-push)
5. ‚úÖ –¢–∞–±–ª–∏—Ü—É –ë–î –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤
6. ‚úÖ Service Worker —Ñ–∞–π–ª
7. ‚úÖ HTTPS –ø—Ä–æ—Ç–æ–∫–æ–ª

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

```
http://–≤–∞—à-—Å–∞–π—Ç.ru/engine/plugins/webpush/check_config.php
```

–°–∫—Ä–∏–ø—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:

- üü¢ –ó–µ–ª–µ–Ω—ã–π –±–ª–æ–∫ - –≤—Å–µ OK
- üü° –ñ–µ–ª—Ç—ã–π –±–ª–æ–∫ - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
- üî¥ –ö—Ä–∞—Å–Ω—ã–π –±–ª–æ–∫ - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–µ—Ä–µ–¥–∞—á–∏ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

```
1. –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ë–ï–ó –∫–ª—é—á–∞ –≤ HTML
2. JavaScript –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å: GET /engine/plugins/webpush/endpoint.php?action=key
3. –°–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç: {"ok": true, "publicKey": "..."}
4. JavaScript –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–ª—é—á
‚ùå –ü—Ä–æ–±–ª–µ–º–∞: –µ—Å–ª–∏ –∑–∞–ø—Ä–æ—Å —É–ø–∞–¥–µ—Ç - –∫–ª—é—á –Ω–µ –ø–æ–ª—É—á–µ–Ω!
```

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

```
1. PHP (webpush.php) –ø–µ—Ä–µ–¥–∞–µ—Ç –∫–ª—é—á –≤ $tvars['public_key']
2. Twig —Ä–µ–Ω–¥–µ—Ä–∏—Ç: <button ... data-public-key="BNx7...">
3. JavaScript —á–∏—Ç–∞–µ—Ç: btn.dataset.publicKey
4. –ï—Å–ª–∏ –ø—É—Å—Ç–æ - fallback –Ω–∞ API –∑–∞–ø—Ä–æ—Å
‚úÖ –ö–ª—é—á –¥–æ—Å—Ç—É–ø–µ–Ω —Å—Ä–∞–∑—É, –±–µ–∑ –∑–∞–¥–µ—Ä–∂–µ–∫ –∏ –æ—à–∏–±–æ–∫!
```

## üß™ –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –û—Ç–∫—Ä–æ–π—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç:

```
http://–≤–∞—à-—Å–∞–π—Ç.ru/engine/plugins/webpush/check_config.php
```

**–ß—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**

- ‚úÖ –ü–ª–∞–≥–∏–Ω –ê–ö–¢–ò–í–ï–ù
- ‚úÖ enabled: –î–ê
- ‚úÖ show_button: –î–ê
- ‚úÖ Public Key: ‚úì –ù–∞—Å—Ç—Ä–æ–µ–Ω
- ‚úÖ Private Key: ‚úì –ù–∞—Å—Ç—Ä–æ–µ–Ω
- ‚úÖ Subject: ‚úì –ù–∞—Å—Ç—Ä–æ–µ–Ω
- ‚úÖ minishlink/web-push: –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ –ø–æ–¥–ø–∏—Å–æ–∫: –°–æ–∑–¥–∞–Ω–∞

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (Ctrl+U):

```html
<button
  type="button"
  id="webpush-subscribe-btn"
  data-endpoint="..."
  data-public-key="BNx7o-ZhqLOD9..."></button>
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**

- `data-public-key` –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –¥–ª–∏–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É (80+ —Å–∏–º–≤–æ–ª–æ–≤)
- –°—Ç—Ä–æ–∫–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `B` (Base64 URL-safe)

### 3. –ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12 ‚Üí Console):

```javascript
// –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
Using public key from button data-attribute
```

**–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ:**

```
Fetching public key from server...
```

–ó–Ω–∞—á–∏—Ç –∫–ª—é—á –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω –≤ data-–∞—Ç—Ä–∏–±—É—Ç!

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏:

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å–∞–π—Ç (HTTPS!)
2. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É "–í–∫–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"
3. –ë—Ä–∞—É–∑–µ—Ä –¥–æ–ª–∂–µ–Ω –∑–∞–ø—Ä–æ—Å–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ
4. –ü–æ—Å–ª–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è - –∫–Ω–æ–ø–∫–∞ –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ "–û—Ç–∫–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"
5. –í –ª–æ–≥–∞—Ö `engine/plugins/webpush/logs/webpush.log`:
   ```
   [2026-01-17 XX:XX:XX] [info] Subscribe: fcm.googleapis.com (desktop) | IP: ...
   ```

## üîß –ß—Ç–æ –¥–µ–ª–∞—Ç—å –µ—Å–ª–∏ –∫–ª—é—á –≤—Å–µ –µ—â–µ "–Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω"

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ö–ª—é—á –Ω–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –ë–î

1. **–û—Ç–∫—Ä–æ–π—Ç–µ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ‚Üí –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞–≥–∏–Ω–∞–º–∏ ‚Üí webpush ‚Üí –ù–∞—Å—Ç—Ä–æ–π–∫–∏**
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–ª—è:**

   - VAPID Public Key - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–æ (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `B`)
   - VAPID Private Key - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–æ
   - VAPID Subject - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `mailto:–≤–∞—à@email.ru` –∏–ª–∏ `https://–≤–∞—à-—Å–∞–π—Ç.ru`

3. **–ï—Å–ª–∏ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ - —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∫–ª—é—á–∏:**
   ```
   http://–≤–∞—à-—Å–∞–π—Ç.ru/engine/plugins/webpush/send.php?action=genkeys
   ```
   –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–ª—é—á–∏ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–ª–∞–≥–∏–Ω–∞, –°–û–•–†–ê–ù–ò–¢–ï!

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ö–ª—é—á –≤ –ë–î, –Ω–æ –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ —à–∞–±–ª–æ–Ω

1. **–û—á–∏—Å—Ç–∏—Ç–µ –∫–µ—à:**

   ```
   C:\OSPanel\home\test.ru\engine\cache\ - —É–¥–∞–ª–∏—Ç–µ –≤—Å–µ —Ñ–∞–π–ª—ã
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é pluginGetVariable:**

   ```php
   // –í webpush.php –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
   $tvars = [
       'public_key' => pluginGetVariable('webpush', 'vapid_public'),
       ...
   ];
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ engine/conf/plugdata.php**

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ö–ª—é—á –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è, –Ω–æ –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç

VAPID –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å:

- **–î–ª–∏–Ω–∞:** 87-88 —Å–∏–º–≤–æ–ª–æ–≤
- **–§–æ—Ä–º–∞—Ç:** Base64 URL-safe (A-Za-z0-9\_-)
- **–ù–∞—á–∞–ª–æ:** –û–±—ã—á–Ω–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `B`

**–ü—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∫–ª—é—á–∞:**

```
BNx7o-ZhqLOD9VqKpvdQPU_QWJ3MvZ9kYhXxFjKqL8mN2pRsT4uVwXyZ0A1B2C3D4E5F6G7H8I9J0K1L2M3N4O5P
```

**–ù–ï –ø—Ä–∞–≤–∏–ª—å–Ω–æ:**

- `BNx7...` (—Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π)
- –ö–ª—é—á —Å –ø—Ä–æ–±–µ–ª–∞–º–∏
- –ö–ª—é—á —Å —Å–∏–º–≤–æ–ª–∞–º–∏ `+/=` (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `-_`)

## üìù –°–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

1. ‚úÖ **engine/plugins/webpush/tpl/webpush.tpl**

   - –î–æ–±–∞–≤–ª–µ–Ω data-public-key="{{ public_key }}"

2. ‚úÖ **engine/plugins/webpush/js/webpush.js**

   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è publicKeyFromButton
   - –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è getPublicKey() —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º data-–∞—Ç—Ä–∏–±—É—Ç–∞
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

3. ‚úÖ **engine/plugins/webpush/endpoint.php**

   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω if (empty($endpoint)) –Ω–∞ —Å—Ç—Ä–æ–∫–µ 191
   - –£–¥–∞–ª–µ–Ω –¥—É–±–ª–∏–∫–∞—Ç –∫–æ–¥–∞ –Ω–∞ —Å—Ç—Ä–æ–∫–µ 219

4. ‚úÖ **engine/plugins/webpush/check_config.php** (–ù–û–í–´–ô)

   - –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
   - –ü–æ—à–∞–≥–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

5. ‚úÖ **engine/plugins/webpush/version**
   - –û–±–Ω–æ–≤–ª–µ–Ω–∞ –≤–µ—Ä—Å–∏—è: 1.0.3 ‚Üí 1.0.4

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

- ‚úÖ –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ HTML —Å—Ä–∞–∑—É –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π AJAX-–∑–∞–ø—Ä–æ—Å
- ‚úÖ –û—à–∏–±–∫–∞ "–ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω" –±–æ–ª—å—à–µ –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- ‚úÖ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ PHP

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –î–æ (v1.0.3):

```
1. –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞: 0ms
2. JS –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: 50ms
3. AJAX –∑–∞–ø—Ä–æ—Å –∫–ª—é—á–∞: 100-500ms (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞)
4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞: 50ms
Total: 200-600ms –¥–æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫–Ω–æ–ø–∫–∏
```

### –ü–æ—Å–ª–µ (v1.0.4):

```
1. –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞: 0ms (–∫–ª—é—á —É–∂–µ –≤ HTML)
2. JS –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: 50ms
Total: 50ms –¥–æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫–Ω–æ–ø–∫–∏
–£—Å–∫–æ—Ä–µ–Ω–∏–µ: 4-12x
```

## ‚ö†Ô∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- NGCMS 0.9.3+
- PHP 7.4+
- Twig 3.x
- ng-helpers v0.2.0+ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- HTTPS (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è Web Push API)
- Composer –ø–∞–∫–µ—Ç `minishlink/web-push`

## üîó –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:** `/engine/plugins/webpush/check_config.php`
- **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π:** `/engine/plugins/webpush/send.php?action=genkeys`
- **–õ–æ–≥–∏:** `/engine/plugins/webpush/logs/webpush.log`

## üë®‚Äçüíª –ê–≤—Ç–æ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–ú–æ–¥–µ—Ä–Ω–∏–∑–∞—Ü–∏—è:** NGCMS Team
**–î–∞—Ç–∞:** 17 —è–Ω–≤–∞—Ä—è 2026
